{"2384": {"code": ["\n\n\n\n\n-----Example-----\n\nExample:\n\n1\n2\n3\n4\n2\n2\n5\n6\n9\n\n\n\n\n\n\n\n\n\n-----Example-----\n\n\n\n\n\n3\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n-----Example-----\n\n\n\n\n\n\n\n$n$\n4\n7\n", "\n\n\n\n\n-----Example-----\n\nInput\n9\n5\n4\n\n\n\nInput\n9\n5\n4\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n \n\n\n\n\n\n-----Example-----\n\nExample\n\n9\n5\n4\n2\n2\n\n-----Example-----\n\n\n\n\n\n\n\n\n\n\n\n-----", "\n\n\n\n\n\n-----Example-----\n\nExample:\n\n5\n9\n\n\n\nThe first line contains an integer $t$, the number of test cases in one test\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nOutput\n10\n\n-----Example-----\n\n\n\n\n-----Example-----\n", "\n\n\n\n\n-----Example-----\nExample:\n\n1\n5\n4\n2\n\n\n\n\n\n\n3\n2\n6\n8\n\n\n\n\n\n\n\n\n \n\n\n \n\n\n\n\n-----Example-----\n\nThe first line contains a single integer $n$ ($1 \\le n$) \n\nThe\n\n\n\n\n\n-----Example-----", "\n\n\n\n\n-----Example-----\n\nExample:\n\n6\n9\n5\n4\n6\n\n\n\nInput-----\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n \n\n\n \n\n\n-----Example-----\n\nle n$ \n\nThe above lines are the same.\n\n-----Example-----\n\n\n\n\n\n\n\n\n\n\n\n$", "\n\n\n\n\n\n\n\n\n\n\n9\n5\n4\n5\n2\n2\n3\n4\n5\n2\n3\n4\n5\n2\n2\n3\n3\n2\n\n\n\n\n3\n5\n\n\n\n\n\n\n\n\n\n\n\n\n\n-----Example-----\n\n\n\n\n\n\n-----Example-----\nOutput\n9", "\n\n\n\n-----Example-----\n\n\n-----Example-----\n\nInput\n9\n5\n4\n2\n2\n5\n2\n2\n9\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n2\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n-----Example-----\n\nInput\n", "\n\n\n\n-----Example-----\n\nInput\n9\n5\n4\n2\n5\n2\n2\n2\n3\n4\n2\n2\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n2\n3\n\n\n\n\n\n \n\n\n\n\n\n\n\n\n\n\n\n\n$t$\n$a\n\n$i$ \\", "\n\n\n\n-----Example-----\nExample\n\n9\n5\n4\n2\n2\n2\n2\n5\n3\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n1\n2\n3\n2\n1\n\n\n\n\n\n\n\n\n\n-----Example-----\n\n\n\n\n\n\n\n\n\n\n\n\n-----Example-----\n\n1 \\", "\n\n\n\n-----Example-----\n\nInput\n9\n5\n4\n2\n2\n9\n5\n2\n2\n3\n4\n5\n1\n1\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nle t\n\n\n\n\n-----Example-----\nOutput\n9", "\n\n\n\n\n\n\nExample-----\n\nThe number of test cases can be found in one line:\n9\n5\n4\n\n\n\n\n\n\n\n\n\n\n\n \n \n \n\n\n\n-----Example-----\n\nInput\n9\n5\n4\n2 \\le n$ \n\nExample-----\n\n\n\n\n\n\n\n\n\n\n\n-----Example-----\n", "\n\n\n\n\n-----Example-----\n\nInput\n9\n5\n4\n2\n2\n2\n9\n5\n2\n3\n\n\n\n\n\n\n\n\n-----Example-----\n\n\n\n\n\n\n\n\n\n \n\n\n\n\n\n\n\n\n\n\n\n\n-----Example-----\n\n\n\n\n\n\n\n\n-----Example-----\n\n[3", "\n\n\n\n\n-----Example-----\nExample\n\n6\n7\n4\n5\n2\n9\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n \n \n\n\n\nle t$ \n\nThe second line contains a single integer $n$ ($1 \\le n$) \n\n\n\n\n\n\n\n\n\n-----Example-----\n\nOutput\n9", "\n\n\n\n-----Example-----\nExample:\n\n6\n5\n4\n6\n5\n2\n2\n3\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n3\n\n3\n\n\n\n\n\n\n\n-----Example-----\n\n\n\n\n\n\n\n\n-----Example-----\n\n\n\n-----Example-----\n\n4\n5\n2\n2", "\n\n\n-----Example-----\nExample\n\n9\n5\n4\n\n\n\n\n\n\nExample-----\n\nThe number of test cases in the problem is greater than the number of test cases in the problem. \n\nThe number of test cases are greater than the number of test cases in the problem. \n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n", "\n\n\n-----Example-----\nExample\n\n1\n9\n5\n4\n2\n2\n4\n5\n9\n5\n2\n5\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n \n\n\n\n\n\n\n\n\n\n\nt\n\n\n\n\n\n\n-----Example-----\nOutput\n9\n5\n", "\n\n\n\n\n\n\n-----Example-----\n\n\n\n-----Example-----\n\nThe problem can be a hard version of the problem.\n\n-----Input-----\n\n9\n5\n4\n2\n2\n5\n4\n2\n2\n3\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n1 \\", "\n\n\n1 \\le t \\le 10^4$\n2 \\le 10^9$\n\n-----Example-----\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n-----Example-----\n\nOutput\n9\n5\n4\n2\n2\n9\n2\n\n-----Example-----\n\n\n\n\n\n\n\n\n\n\n\n\n", "\n\n\n-----Example-----\n\nExample:\n\n4\n5\n6\n\n\n\n\n\n\n\n\n\n1\n2\n3\n5\n2\n6\n7\n\n\n\n\n\n\n\n\n\n \n\n\n\n\n\n-----Example-----\n\n\n\n\n\n\n\n\n\n\n-----Example-----\nOutput\n\n9\n5\n4\n\n\n", "\n\n\n-----Example-----\nExample\n\n1\n5\n4\n2\n9\n5\n2\n2\n2\n2\n2\n3\n\n\n\n\n\n\n\n\n\n\n\n\n\n3\n2\n3\n\n\n\n\n \n \n\n \n\n\n\n\n\n\n\n-----Example-----\n\n\n\n\n\n\n\n-----Example-----\nOutput\n"], "prompt": "\nQUESTION:\nThis is a hard version of the problem. In this version, the given array can contain equal elements and the constraints on $n$ are greater than in the easy version of the problem.\n\nYou are given an array $a$ of $n$ integers (the given array can contain equal elements). You can perform the following operations on array elements:  choose any index $i$ ($1 \\le i \\le n$) and move the element $a[i]$ to the begin of the array;  choose any index $i$ ($1 \\le i \\le n$) and move the element $a[i]$ to the end of the array. \n\nFor example, if $n = 5$, $a = [4, 7, 2, 2, 9]$, then the following sequence of operations can be performed:   after performing the operation of the first type to the second element, the array $a$ will become $[7, 4, 2, 2, 9]$;  after performing the operation of the second type to the second element, the array $a$ will become $[7, 2, 2, 9, 4]$. \n\nYou can perform operations of any type any number of times in any order.\n\nFind the minimum total number of operations of the first and second type that will make the $a$ array sorted in non-decreasing order. In other words, what is the minimum number of operations must be performed so the array satisfies the inequalities $a[1] \\le a[2] \\le \\ldots \\le a[n]$.\n\n\n-----Input-----\n\nThe first line contains a single integer $t$ ($1 \\le t \\le 10^4$)\u00a0\u2014 the number of test cases in the test. Then $t$ test cases follow.\n\nEach test case starts with a line containing an integer $n$ ($1 \\le n \\le 2 \\cdot 10^5$)\u00a0\u2014 the size of the array $a$.\n\nThen follow $n$ integers $a_1, a_2, \\ldots, a_n$ ($0 \\le a_i \\le 10^9$)\u00a0\u2014 an array that needs to be sorted by the given operations. The given array can contain equal elements.\n\nThe sum of $n$ for all test cases in one test does not exceed $2 \\cdot 10^5$.\n\n\n-----Output-----\n\nFor each test case output one integer\u00a0\u2014 the minimum total number of operations of the first and second type, which will make the array sorted in non-decreasing order.\n\n\n-----Example-----\nInput\n9\n5\n4 7 2 2 9\n5\n3 5 8 1 7\n5\n1 2 2 4 5\n2\n0 1\n3\n0 1 0\n4\n0 1 0 0\n4\n0 1 0 1\n4\n0 1 0 2\n20\n16 15 1 10 0 14 0 10 3 9 2 5 4 5 17 9 10 20 0 9\n\nOutput\n2\n2\n0\n0\n1\n1\n1\n1\n16\n\n\n\n-----Note-----\n\nIn the first test case, you first need to move two 2, to the beginning of the array. Therefore, the desired sequence of operations: $[4, 7, 2, 2, 9] \\rightarrow [2, 4, 7, 2, 9] \\rightarrow [2, 2, 4, 7, 9]$.\n\nIn the second test case, you need to move the 1 to the beginning of the array, and the 8\u00a0\u2014 to the end. Therefore, the desired sequence of operations: $[3, 5, 8, 1, 7] \\rightarrow [1, 3, 5, 8, 7] \\rightarrow [1, 3, 5, 7, 8]$.\n\nIn the third test case, the array is already sorted.\nUse Standard Input format\nANSWER:\n"}}